<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>CRM Gastos Viaje - Con Tabla y Filtros</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

  <style>
    /* ====== Dise√±o base con temas ====== */
    :root{
      /* LIGHT */
      --bg: #f7f9fc;
      --bg-soft: #ffffff;
      --bg-glass: rgba(255,255,255,0.75);
      --stroke: rgba(9,30,66,0.12);
      --text: #0f172a;
      --muted: #6b7280;

      --primary: #2563eb;
      --primary-2: #3b82f6;
      --success: #16a34a;
      --danger: #dc2626;

      --gasolina:#2563eb;
      --hotel:#7c3aed;
      --comida:#059669;
      --bebida:#d97706;

      --radius-lg:16px;
      --radius:12px;
      --radius-sm:10px;

      --shadow-xl: 0 24px 60px rgba(2,6,23,0.08);
      --shadow-md: 0 14px 36px rgba(2,6,23,0.08);
      --shadow-sm: 0 8px 20px rgba(2,6,23,0.06);
    }

    /* DARK THEME */
    [data-theme="dark"]{
      --bg: #0b1220;
      --bg-soft: #0f172a;
      --bg-glass: rgba(17,24,39,0.55);
      --stroke: rgba(148,163,184,0.16);
      --text: #e5e7eb;
      --muted: #94a3b8;

      --primary:#60a5fa; --primary-2:#3b82f6;
      --success:#34d399; --danger:#f87171;

      --gasolina:#60a5fa; --hotel:#a78bfa; --comida:#34d399; --bebida:#f59e0b;
    }

    @media (prefers-color-scheme: dark){
      :root{ color-scheme: dark; }
    }

    html { font-size: clamp(14px, 2.2vw, 16px); }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; }
    }

    body{
      margin:0; min-height:100vh; color:var(--text);
      background: radial-gradient(1200px 800px at 100% -10%, var(--bg-soft) 0%, transparent 40%),
                  radial-gradient(1000px 700px at -10% 0%, var(--bg-soft) 0%, transparent 45%),
                  linear-gradient(180deg, var(--bg), var(--bg));
      padding-bottom: calc(76px + env(safe-area-inset-bottom, 12px));
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    /* ===== Top App Bar ===== */
    .topbar{
      position: sticky; top:0; z-index: 1000;
      padding: calc(10px + env(safe-area-inset-top, 6px)) 14px 10px;
      background: linear-gradient(180deg, var(--bg-glass), rgba(255,255,255,0.02));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--stroke);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{ display:flex; align-items:center; gap:10px; }
    .brand i{ color: var(--primary); font-size: 1.15rem; }
    .brand h1{ margin:0; font-size:1rem; letter-spacing:.3px; font-weight:800; }

    .top-actions{ display:flex; gap:10px; align-items:center; }
    .theme-toggle{
      min-width:40px; min-height:40px; border-radius: 12px;
      background: var(--bg-glass); border:1px solid var(--stroke); color: var(--text);
      display:flex; align-items:center; justify-content:center;
    }
    .badge-total{
      display:flex; align-items:center; gap:10px;
      background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.1));
      border:1px solid rgba(96,165,250,0.35);
      padding:8px 12px; border-radius: 999px;
      box-shadow: var(--shadow-sm);
      min-height: 38px;
    }
    .badge-total i{ color: var(--primary); }
    #trip-total-badge{ font-weight:900; }

    /* ===== Containers / Cards ===== */
    .container-main{ padding: 14px; }
    .glass{
      background: var(--bg-glass);
      border:1px solid var(--stroke);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
    }
    .section{ margin-top:12px; }

    /* ===== Stats ===== */
    .stats-card{
      display:flex; justify-content:space-between; align-items:center; gap:14px;
      padding:14px;
    }
    .stats-card .label{ color: var(--muted); font-weight:700; font-size:.9rem; }
    .stats-card .amount{
      font-weight:900; font-size:1.6rem;
      background: linear-gradient(90deg, var(--success), #10b981);
      -webkit-background-clip:text; color:transparent;
    }

    /* ===== Filters (chips) - MEJORADO ===== */
    .filters-section {
      padding: 14px;
      margin-bottom: 12px;
    }
    
    .search-box {
      margin-bottom: 12px;
    }
    
    .search-box input {
      width: 100%;
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:12px 40px 12px 14px;
      font-size:16px;
    }
    
    .search-box .search-icon {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      pointer-events: none;
    }
    
    .chips{ 
      display:grid; 
      grid-template-columns: 1fr; 
      gap:10px;
    }
    @media (min-width: 390px){ 
      .chips{ 
        grid-template-columns: repeat(2, 1fr); 
      } 
    }
    @media (min-width: 768px){ 
      .chips{ 
        grid-template-columns: repeat(3, 1fr); 
      } 
    }
    
    .chip{ display:flex; flex-direction:column; gap:6px; }
    .chip label{ color: var(--muted); font-weight:800; font-size:.82rem; margin:0 2px; }
    .chip .form-control, .chip .form-select{
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:10px 12px; font-size:16px;
    }
    .chip .form-control:focus, .chip .form-select:focus{
      outline:none; border-color: rgba(96,165,250,0.6);
      box-shadow: 0 0 0 4px rgba(96,165,250,0.18);
    }
    
    .filter-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-end;
    }
    
    .btn-clear-filters {
      background: rgba(220, 38, 38, 0.15);
      border: 1px solid rgba(220, 38, 38, 0.3);
      color: var(--danger);
      padding: 8px 16px;
      border-radius: var(--radius);
      font-weight: 700;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .filter-badge {
      background: rgba(96, 165, 250, 0.2);
      border: 1px solid rgba(96, 165, 250, 0.4);
      color: var(--primary);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 800;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* ===== Category tiles ===== */
    .category-grid{
      display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; margin-top:12px;
    }
    .cat{
      padding:12px; border-radius: var(--radius);
      background: rgba(255,255,255,0.08);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow-sm); text-align:center;
    }
    .cat .k{ color: var(--muted); font-weight:800; font-size:.82rem; }
    .cat .v{ font-weight:900; font-size:1.06rem; margin-top:6px; }
    .gas .v{ color: var(--gasolina); } .hot .v{ color: var(--hotel); }
    .food .v{ color: var(--comida); } .drink .v{ color: var(--bebida); }

    /* ===== Tabs Redesigned ===== */
    .nav-tabs{
      margin-top:12px; border: 1px solid var(--stroke); border-radius: var(--radius-lg);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      overflow: hidden;
    }
    .nav-tabs .nav-link{
      border:none; color: var(--muted); font-weight:900; letter-spacing:.3px;
      padding:12px 14px;
    }
    .nav-tabs .nav-link.active{
      color:var(--text); background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.1));
      border-right: 1px solid var(--stroke);
    }

    /* ===== NUEVA TABLA DE GASTOS ===== */
    .expenses-table-wrapper {
      overflow-x: auto;
      margin-top: 12px;
    }
    
    .expenses-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-glass);
      border-radius: var(--radius);
      overflow: hidden;
    }
    
    .expenses-table thead {
      background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.1));
      border-bottom: 2px solid var(--stroke);
    }
    
    .expenses-table th {
      padding: 12px 14px;
      text-align: left;
      font-weight: 800;
      font-size: 0.85rem;
      color: var(--text);
      border-bottom: 1px solid var(--stroke);
    }
    
    .expenses-table td {
      padding: 12px 14px;
      border-bottom: 1px solid var(--stroke);
      color: var(--text);
    }
    
    .expenses-table tbody tr {
      transition: background 0.2s ease;
    }
    
    .expenses-table tbody tr:hover {
      background: rgba(96, 165, 250, 0.08);
    }
    
    .table-category-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.8rem;
    }
    
    .table-category-badge.gasolina {
      background: rgba(96, 165, 250, 0.2);
      color: var(--gasolina);
      border: 1px solid rgba(96, 165, 250, 0.4);
    }
    
    .table-category-badge.hotel {
      background: rgba(167, 139, 250, 0.2);
      color: var(--hotel);
      border: 1px solid rgba(167, 139, 250, 0.4);
    }
    
    .table-category-badge.comida {
      background: rgba(52, 211, 153, 0.2);
      color: var(--comida);
      border: 1px solid rgba(52, 211, 153, 0.4);
    }
    
    .table-category-badge.bebida {
      background: rgba(245, 158, 11, 0.2);
      color: var(--bebida);
      border: 1px solid rgba(245, 158, 11, 0.4);
    }
    
    .table-actions {
      display: flex;
      gap: 8px;
    }
    
    .table-btn {
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      border: none;
      font-weight: 700;
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s ease;
    }
    
    .table-btn-edit {
      background: rgba(59, 130, 246, 0.15);
      color: var(--primary);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }
    
    .table-btn-edit:hover {
      background: rgba(59, 130, 246, 0.25);
    }
    
    .table-btn-delete {
      background: rgba(220, 38, 38, 0.15);
      color: var(--danger);
      border: 1px solid rgba(220, 38, 38, 0.3);
    }
    
    .table-btn-delete:hover {
      background: rgba(220, 38, 38, 0.25);
    }
    
    .table-amount {
      font-weight: 900;
      color: var(--success);
      font-size: 1.05rem;
    }
    
    .table-date {
      color: var(--muted);
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .table-payment {
      font-size: 0.85rem;
      color: var(--muted);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-state h3 {
      font-size: 1.2rem;
      font-weight: 800;
      margin-bottom: 8px;
    }
    
    .empty-state p {
      font-size: 0.95rem;
    }
    
    /* Responsive table */
    @media (max-width: 768px) {
      .expenses-table th:nth-child(4),
      .expenses-table td:nth-child(4),
      .expenses-table th:nth-child(5),
      .expenses-table td:nth-child(5) {
        display: none;
      }
    }

    /* ===== Load More btn ===== */
    .load-more-container{ margin-top:16px; text-align:center; }
    .load-more-btn{
      background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.1));
      border:1px solid rgba(96,165,250,0.35); color: var(--primary);
      padding:10px 18px; border-radius: var(--radius); font-weight:900; font-size:.9rem;
    }
    .load-more-btn:hover{ background: rgba(96,165,250,0.25); }

    /* ===== Floating action button ===== */
    .fab{
      position: fixed; bottom: calc(76px + env(safe-area-inset-bottom, 16px)); right: 16px;
      width:58px; height:58px; border-radius:50%;
      background: linear-gradient(145deg, var(--primary), var(--primary-2));
      box-shadow: var(--shadow-xl);
      color:#fff; font-size:1.4rem;
      display:flex; align-items:center; justify-content:center;
      border: 2px solid rgba(255,255,255,0.25);
      z-index:999;
    }
    .fab:hover{ box-shadow: 0 30px 70px rgba(2,6,23,0.15); transform: scale(1.05); }

    /* ===== Form ===== */
    .form-section{ padding:14px; }
    .form-group{ margin-bottom:14px; }
    .form-group label{ color: var(--muted); font-weight:800; font-size:.85rem; margin-bottom:6px; display:block; }
    .form-control, .form-select{
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:10px 12px; font-size:16px;
      width:100%;
    }
    .form-control:focus, .form-select:focus{
      outline:none; border-color: rgba(96,165,250,0.6);
      box-shadow: 0 0 0 4px rgba(96,165,250,0.18);
    }
    .form-actions{ display:flex; gap:10px; margin-top:16px; }
    .btn-primary-submit{
      flex:1; padding:12px; border-radius: var(--radius);
      background: linear-gradient(145deg, var(--primary), var(--primary-2));
      color:#fff; font-weight:900; border:none;
    }
    .btn-secondary{
      padding:12px 18px; border-radius: var(--radius);
      background: rgba(255,255,255,0.06); border:1px solid var(--stroke);
      color: var(--text); font-weight:800;
    }

    .trip-total-preview{
      background: linear-gradient(180deg, rgba(52,211,153,0.18), rgba(52,211,153,0.1));
      border:1px solid rgba(52,211,153,0.35);
      padding:12px; border-radius: var(--radius); margin-top:12px;
      display:flex; flex-direction:column; gap:8px;
    }
    .trip-total-preview .row-preview{
      display:flex; justify-content:space-between;
    }
    .trip-total-preview .lbl{ color: var(--muted); font-weight:700; font-size:.85rem; }
    .trip-total-preview .val{ font-weight:900; color: var(--success); }

    /* ===== Chart ===== */
    .chart-container{ position:relative; height:260px; margin-top:14px; }
    .report-percentages{
      display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; margin-top:14px;
    }
    .pct-item{
      background: rgba(255,255,255,0.08);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:10px; text-align:center;
    }
    .pct-item .k{ color: var(--muted); font-size:.85rem; font-weight:800; }
    .pct-item .v{ font-size:1.4rem; font-weight:900; margin-top:4px; }
    .pct-item.gas .v{ color: var(--gasolina); }
    .pct-item.hot .v{ color: var(--hotel); }
    .pct-item.food .v{ color: var(--comida); }
    .pct-item.drink .v{ color: var(--bebida); }

    /* ===== Bottom Nav ===== */
    .bottom-nav{
      position: fixed; bottom:0; left:0; right:0; z-index:1100;
      padding: 10px calc(10px + env(safe-area-inset-right, 0px)) calc(10px + env(safe-area-inset-bottom, 8px)) calc(10px + env(safe-area-inset-left, 0px));
      background: linear-gradient(180deg, var(--bg-glass), rgba(15,23,42,0.92));
      backdrop-filter: blur(12px); border-top: 1px solid var(--stroke);
      display:flex; justify-content:space-around;
    }
    .bottom-nav .nav-item{
      flex:1; display:flex; flex-direction:column; align-items:center; gap:4px; padding:8px;
      border-radius: var(--radius); color: var(--muted);
      transition: all 0.25s ease;
    }
    .bottom-nav .nav-item i{ font-size:1.3rem; }
    .bottom-nav .nav-item span{ font-size:.72rem; font-weight:800; }
    .bottom-nav .nav-item.active{
      background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.1));
      color: var(--primary);
    }

    /* ===== Toast System ===== */
    .toast-container{
      position: fixed; top: calc(env(safe-area-inset-top, 10px) + 60px); right: 16px; z-index:2000;
      display:flex; flex-direction:column; gap:8px;
    }
    .toast-item{
      min-width:260px; padding:12px 16px; border-radius: var(--radius);
      background: var(--bg-soft);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow-xl);
      display:flex; align-items:center; gap:10px;
      animation: slideInRight 0.35s ease;
    }
    @keyframes slideInRight{ from{ opacity:0; transform: translateX(40px); } to{ opacity:1; transform: translateX(0); } }
    .toast-item.success{ border-color: var(--success); }
    .toast-item.danger{ border-color: var(--danger); }
    .toast-item.primary{ border-color: var(--primary); }
    .toast-body{ font-weight:700; font-size:.88rem; }
    
    /* ===== Loading Spinner ===== */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(96, 165, 250, 0.3);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="brand">
      <i class="fas fa-plane-departure"></i>
      <h1>CRM Gastos</h1>
    </div>
    <div class="top-actions">
      <div class="badge-total">
        <i class="fas fa-wallet"></i>
        <span id="trip-total-badge">$0</span>
      </div>
      <button class="theme-toggle" aria-label="Cambiar tema" onclick="toggleTheme()">
        <i class="fas fa-moon" id="themeIcon"></i>
      </button>
    </div>
  </div>

  <div class="container-main" id="appMain">
    <!-- Tabs -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item flex-fill" role="presentation">
        <button class="nav-link active w-100" data-bs-toggle="tab" data-bs-target="#expenses" type="button">
          <i class="fas fa-list"></i> Gastos
        </button>
      </li>
      <li class="nav-item flex-fill" role="presentation">
        <button class="nav-link w-100" data-bs-toggle="tab" data-bs-target="#reports" type="button">
          <i class="fas fa-chart-pie"></i> Reportes
        </button>
      </li>
      <li class="nav-item flex-fill" role="presentation">
        <button class="nav-link w-100" data-bs-toggle="tab" data-bs-target="#add" type="button">
          <i class="fas fa-plus-circle"></i> Agregar
        </button>
      </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content">
      <!-- TAB 1: GASTOS CON TABLA Y FILTROS -->
      <div class="tab-pane fade show active" id="expenses">
        
        <!-- Filtros Mejorados -->
        <div class="glass filters-section section">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0" style="font-size: 1.1rem; font-weight: 800;">
              <i class="fas fa-filter"></i> Filtros de B√∫squeda
            </h3>
            <span class="filter-badge" id="activeFiltersCount">0 activos</span>
          </div>
          
          <!-- B√∫squeda por texto -->
          <div class="search-box position-relative">
            <input 
              type="text" 
              id="filter-search" 
              placeholder="üîç Buscar por descripci√≥n..."
              class="form-control"
            />
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <!-- Filtros en grid -->
          <div class="chips">
            <div class="chip">
              <label>Categor√≠a</label>
              <select id="filter-category" class="form-select">
                <option value="">Todas</option>
                <option value="gasolina">Gasolina</option>
                <option value="hotel">Hotel</option>
                <option value="comida">Comida</option>
                <option value="bebida">Bebida</option>
              </select>
            </div>
            <div class="chip">
              <label>Mes</label>
              <input type="month" id="filter-date" class="form-control" />
            </div>
            <div class="chip">
              <label>Viaje</label>
              <select id="filter-trip" class="form-select">
                <option value="">Todos los viajes</option>
              </select>
            </div>
          </div>
          
          <!-- Bot√≥n limpiar filtros -->
          <div class="filter-actions">
            <button class="btn-clear-filters" id="btnClearFilters">
              <i class="fas fa-times-circle"></i> Limpiar filtros
            </button>
          </div>
        </div>

        <!-- Stats -->
        <div class="glass stats-card section">
          <span class="label"><i class="fas fa-coins"></i> Total general:</span>
          <span class="amount" id="total-amount">$0</span>
        </div>

        <!-- Category cards -->
        <div class="category-grid">
          <div class="cat gas">
            <div class="k">GASOLINA</div>
            <div class="v" id="gasolina-amount">$0</div>
          </div>
          <div class="cat hot">
            <div class="k">HOTEL</div>
            <div class="v" id="hotel-amount">$0</div>
          </div>
          <div class="cat food">
            <div class="k">COMIDA</div>
            <div class="v" id="comida-amount">$0</div>
          </div>
          <div class="cat drink">
            <div class="k">BEBIDA</div>
            <div class="v" id="bebida-amount">$0</div>
          </div>
        </div>

        <!-- TABLA DE GASTOS -->
        <div class="expenses-table-wrapper">
          <table class="expenses-table" id="expensesTable">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Descripci√≥n</th>
                <th>Categor√≠a</th>
                <th>Viaje</th>
                <th>Pago</th>
                <th>Monto</th>
                <th style="text-align: center;">Acciones</th>
              </tr>
            </thead>
            <tbody id="expense-list-tbody">
              <!-- Aqu√≠ se cargar√°n las filas din√°micamente -->
              <tr>
                <td colspan="7" style="text-align: center; padding: 20px;">
                  <div class="loading-spinner"></div>
                  <div style="margin-top: 10px; color: var(--muted);">Cargando gastos...</div>
                </td>
              </tr>
            </tbody>
          </table>
          
          <!-- Estado vac√≠o -->
          <div class="empty-state" id="emptyState" style="display: none;">
            <i class="fas fa-inbox"></i>
            <h3>No hay gastos</h3>
            <p>Agrega tu primer gasto para comenzar</p>
          </div>
        </div>

        <!-- Load more -->
        <div class="load-more-container" id="loadMoreContainer" style="display:none;">
          <button class="load-more-btn" id="loadMoreBtn">
            <i class="fas fa-chevron-down"></i> Cargar m√°s
          </button>
        </div>
      </div>

      <!-- TAB 2: REPORTES -->
      <div class="tab-pane fade" id="reports">
        <div class="glass stats-card section">
          <span class="label"><i class="fas fa-chart-line"></i> Total general:</span>
          <span class="amount" id="total-amount-reports">$0</span>
        </div>

        <div class="glass section" style="padding:14px;">
          <div class="chart-container">
            <canvas id="expenses-chart"></canvas>
          </div>
        </div>

        <div class="report-percentages">
          <div class="pct-item gas">
            <div class="k">Gasolina</div>
            <div class="v" id="report-gasolina">0%</div>
          </div>
          <div class="pct-item hot">
            <div class="k">Hotel</div>
            <div class="v" id="report-hotel">0%</div>
          </div>
          <div class="pct-item food">
            <div class="k">Comida</div>
            <div class="v" id="report-comida">0%</div>
          </div>
          <div class="pct-item drink">
            <div class="k">Bebida</div>
            <div class="v" id="report-bebida">0%</div>
          </div>
        </div>
      </div>

      <!-- TAB 3: AGREGAR -->
      <div class="tab-pane fade" id="add">
        <form id="expense-form" class="form-section">
          <input type="hidden" id="edit-id" />

          <div class="form-group">
            <label>Fecha *</label>
            <input type="date" id="expense-date" class="form-control" required />
          </div>

          <div class="form-group">
            <label>Categor√≠a *</label>
            <select id="expense-category" class="form-select" required>
              <option value="">Selecciona</option>
              <option value="gasolina">Gasolina</option>
              <option value="hotel">Hotel</option>
              <option value="comida">Comida</option>
              <option value="bebida">Bebida</option>
            </select>
          </div>

          <div class="form-group">
            <label>Descripci√≥n *</label>
            <input type="text" id="expense-description" class="form-control" required />
          </div>

          <div class="form-group">
            <label>Monto (MXN) *</label>
            <input type="number" id="expense-amount" class="form-control" step="0.01" min="0" required />
          </div>

          <div class="form-group">
            <label>M√©todo de pago</label>
            <select id="expense-payment-method" class="form-select">
              <option value="Efectivo">Efectivo</option>
              <option value="Tarjeta">Tarjeta</option>
              <option value="Transferencia">Transferencia</option>
            </select>
          </div>

          <div class="form-group">
            <label>Viaje (opcional)</label>
            <input type="text" id="expense-trip" class="form-control" list="trip-options" placeholder="Ej: Guadalajara Dic 2024"/>
            <datalist id="trip-options"></datalist>
          </div>

          <div class="trip-total-preview">
            <div class="row-preview">
              <span class="lbl">Total actual del viaje:</span>
              <span class="val" id="current-total-form">$0</span>
            </div>
            <div class="row-preview">
              <span class="lbl">Proyecci√≥n con este gasto:</span>
              <span class="val" id="projected-total-form">$0</span>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" id="btnClearForm">
              <i class="fas fa-eraser"></i> Limpiar
            </button>
            <button type="submit" class="btn-primary-submit">
              <i class="fas fa-save"></i> <span id="submitLabel">Guardar</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- FAB -->
  <button class="fab" aria-label="Agregar gasto">
    <i class="fas fa-plus"></i>
  </button>

  <!-- Bottom Nav -->
  <div class="bottom-nav">
    <div class="nav-item active" data-target="#expenses">
      <i class="fas fa-list"></i>
      <span>Gastos</span>
    </div>
    <div class="nav-item" data-target="#reports">
      <i class="fas fa-chart-pie"></i>
      <span>Reportes</span>
    </div>
    <div class="nav-item" data-target="#add">
      <i class="fas fa-plus-circle"></i>
      <span>Agregar</span>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- Firebase v10 modular -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, limit, startAfter, updateDoc, deleteDoc, Timestamp, doc }
      from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ===== CONFIG - IMPORTANTE: Reemplaza con tu configuraci√≥n real =====
    const firebaseConfig = {
      apiKey: "AIzaSyBXm8K5example-REPLACE-WITH-YOUR-REAL-KEY",
      authDomain: "your-project.firebaseapp.com",
      projectId: "your-project-id",
      storageBucket: "your-project.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdefexample"
    };

    // Intentar inicializar Firebase
    let app, db;
    let firebaseInitialized = false;
    
    try {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      firebaseInitialized = true;
      console.log("‚úÖ Firebase inicializado correctamente");
    } catch (error) {
      console.error("‚ùå Error al inicializar Firebase:", error);
      showToast("‚ö†Ô∏è Error: Configura Firebase en el c√≥digo", "danger");
    }

    window.db = db;
    window.firestoreMethods = { collection, addDoc, getDocs, query, where, orderBy, limit, startAfter, updateDoc, deleteDoc, Timestamp, doc };

    /* ===== HELPERS ===== */
    const $ = id => document.getElementById(id);
    const formatCurrency = (val) => new Intl.NumberFormat('es-MX', { style:'currency', currency:'MXN' }).format(val || 0);
    
    function debounce(fn, delay=300){
      let t;
      return function(...args){
        clearTimeout(t);
        t = setTimeout(()=> fn.apply(this, args), delay);
      };
    }

    /* ===== TOAST ===== */
    function showToast(message, type='primary'){
      const c = $("toastContainer");
      const t = document.createElement('div');
      t.className = `toast-item ${type}`;
      t.innerHTML = `<div class="toast-body">${message}</div>`;
      c.appendChild(t);
      setTimeout(() => t.remove(), 5000);
    }

    /* ===== THEME ===== */
    function toggleTheme(){
      const html = document.documentElement;
      const theme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      const icon = $("themeIcon");
      icon.className = theme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
    }
    window.toggleTheme = toggleTheme;

    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    $("themeIcon").className = savedTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';

    /* ===== STATE ===== */
    let lastVisible = null;
    let allExpenses = [];
    let tripTotals = {};

    /* ===== ADD / UPDATE / DELETE EXPENSE ===== */
    async function addExpense(data){
      if (!firebaseInitialized) {
        showToast("‚ö†Ô∏è Firebase no configurado", "danger");
        return false;
      }
      
      try{
        const docData = {
          date: Timestamp.fromDate(new Date(data.date)),
          category: data.category,
          description: data.description,
          amount: data.amount,
          paymentMethod: data.paymentMethod || 'Efectivo',
          trip: data.trip || null,
          createdAt: Timestamp.now()
        };
        await addDoc(collection(db, "travel_expenses"), docData);
        console.log("‚úÖ Gasto agregado:", docData);
        return true;
      }catch(e){
        console.error("‚ùå Error adding expense:", e);
        showToast(`Error: ${e.message}`, "danger");
        return false;
      }
    }

    async function updateExpense(id, data){
      if (!firebaseInitialized) {
        showToast("‚ö†Ô∏è Firebase no configurado", "danger");
        return false;
      }
      
      try{
        const docRef = doc(db, "travel_expenses", id);
        await updateDoc(docRef, {
          date: Timestamp.fromDate(new Date(data.date)),
          category: data.category,
          description: data.description,
          amount: data.amount,
          paymentMethod: data.paymentMethod,
          trip: data.trip || null
        });
        console.log("‚úÖ Gasto actualizado:", id);
        return true;
      }catch(e){
        console.error("‚ùå Error updating expense:", e);
        showToast(`Error: ${e.message}`, "danger");
        return false;
      }
    }

    async function deleteExpense(id){
      if (!firebaseInitialized) {
        showToast("‚ö†Ô∏è Firebase no configurado", "danger");
        return false;
      }
      
      try{
        const docRef = doc(db, "travel_expenses", id);
        await deleteDoc(docRef);
        console.log("‚úÖ Gasto eliminado:", id);
        return true;
      }catch(e){
        console.error("‚ùå Error deleting expense:", e);
        showToast(`Error: ${e.message}`, "danger");
        return false;
      }
    }

    /* ===== FETCH & RENDER ===== */
    async function fetchExpenses(reset = false){
      if (!firebaseInitialized) {
        console.warn("‚ö†Ô∏è Firebase no inicializado, no se pueden cargar gastos");
        renderExpenses(); // Mostrar tabla vac√≠a
        return;
      }
      
      if(reset){
        lastVisible = null;
        allExpenses = [];
      }

      try{
        let baseQuery = query(
          collection(db, "travel_expenses"), 
          orderBy("date","desc"), 
          limit(50)
        );
        
        if(!reset && lastVisible){
          baseQuery = query(
            collection(db, "travel_expenses"), 
            orderBy("date","desc"), 
            startAfter(lastVisible), 
            limit(50)
          );
        }

        const snap = await getDocs(baseQuery);
        console.log(`üìä Documentos encontrados: ${snap.size}`);
        
        if(!snap.empty){
          lastVisible = snap.docs[snap.docs.length - 1];
          const batch = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          allExpenses = reset ? batch : [...allExpenses, ...batch];
          console.log(`‚úÖ Total gastos cargados: ${allExpenses.length}`);
        }
        
        renderExpenses();
        updateCounters();
      }catch(e){
        console.error("‚ùå Fetch error:", e);
        showToast(`Error al cargar: ${e.message}`, "danger");
        renderExpenses(); // Mostrar vac√≠o en caso de error
      }
    }

    async function goToFirstPageAndRefresh(){
      await fetchExpenses(true);
    }

    async function loadMore(){
      await fetchExpenses(false);
    }

    function getFilters(){
      return {
        search: ($("filter-search").value || '').trim().toLowerCase(),
        category: $("filter-category").value || '',
        date: $("filter-date").value || '',
        trip: $("filter-trip").value || ''
      };
    }

    function applyFilters(expenses){
      const filters = getFilters();
      let filtered = expenses;

      // B√∫squeda por texto
      if(filters.search){
        filtered = filtered.filter(e => 
          (e.description || '').toLowerCase().includes(filters.search)
        );
      }

      // Categor√≠a
      if(filters.category){
        filtered = filtered.filter(e => e.category === filters.category);
      }

      // Mes
      if(filters.date){
        const [year, month] = filters.date.split('-');
        filtered = filtered.filter(e => {
          if(!e.date || !e.date.toDate) return false;
          const d = e.date.toDate();
          return d.getFullYear() === parseInt(year) && (d.getMonth() + 1) === parseInt(month);
        });
      }

      // Viaje
      if(filters.trip){
        filtered = filtered.filter(e => (e.trip || '') === filters.trip);
      }

      return filtered;
    }

    function updateActiveFiltersCount(){
      const filters = getFilters();
      let count = 0;
      if(filters.search) count++;
      if(filters.category) count++;
      if(filters.date) count++;
      if(filters.trip) count++;
      $("activeFiltersCount").textContent = `${count} activos`;
    }

    function renderExpenses(){
      const tbody = $("expense-list-tbody");
      const emptyState = $("emptyState");
      const loadMoreContainer = $("loadMoreContainer");
      
      const filtered = applyFilters(allExpenses);
      
      updateActiveFiltersCount();
      
      if(filtered.length === 0){
        tbody.innerHTML = '';
        emptyState.style.display = 'block';
        loadMoreContainer.style.display = 'none';
        return;
      }

      emptyState.style.display = 'none';
      loadMoreContainer.style.display = filtered.length >= 50 ? 'block' : 'none';

      tbody.innerHTML = filtered.map(exp => {
        const dateStr = exp.date && exp.date.toDate ? exp.date.toDate().toLocaleDateString('es-MX') : 'Sin fecha';
        const catClass = exp.category || '';
        const catLabel = {
          gasolina: 'Gasolina',
          hotel: 'Hotel',
          comida: 'Comida',
          bebida: 'Bebida'
        }[exp.category] || exp.category || 'Sin categor√≠a';

        return `
          <tr>
            <td class="table-date">${dateStr}</td>
            <td style="font-weight: 600;">${exp.description || 'Sin descripci√≥n'}</td>
            <td>
              <span class="table-category-badge ${catClass}">${catLabel}</span>
            </td>
            <td class="table-payment">${exp.trip || '‚Äî'}</td>
            <td class="table-payment">${exp.paymentMethod || 'Efectivo'}</td>
            <td class="table-amount">${formatCurrency(exp.amount)}</td>
            <td>
              <div class="table-actions" style="justify-content: center;">
                <button class="table-btn table-btn-edit" onclick="window.editExpense('${exp.id}')">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button class="table-btn table-btn-delete" onclick="window.confirmDelete('${exp.id}')">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    window.editExpense = async (id) => {
      await loadExpenseIntoForm(id);
      new bootstrap.Tab($('[data-bs-target="#add"]')).show();
    };

    window.confirmDelete = async (id) => {
      if(!confirm('¬øEliminar este gasto?')) return;
      setBusy(true);
      const ok = await deleteExpense(id);
      if(ok){
        showToast('‚úÖ Gasto eliminado', 'primary');
        await fetchTripsAndPopulate();
        await goToFirstPageAndRefresh();
      }else{
        showToast('‚ùå Error al eliminar', 'danger');
      }
      setBusy(false);
    };

    function updateCounters(){
      const filtered = applyFilters(allExpenses);
      
      const total = filtered.reduce((sum, e) => sum + (e.amount || 0), 0);
      const catTotals = {
        gasolina: filtered.filter(e => e.category === 'gasolina').reduce((s,e)=> s + (e.amount||0), 0),
        hotel: filtered.filter(e => e.category === 'hotel').reduce((s,e)=> s + (e.amount||0), 0),
        comida: filtered.filter(e => e.category === 'comida').reduce((s,e)=> s + (e.amount||0), 0),
        bebida: filtered.filter(e => e.category === 'bebida').reduce((s,e)=> s + (e.amount||0), 0)
      };

      $("total-amount").textContent = formatCurrency(total);
      $("total-amount-reports").textContent = formatCurrency(total);
      updateCategoryStats(catTotals);
    }

    /* ===== TRIPS ===== */
    async function fetchTripsAndPopulate(){
      if (!firebaseInitialized) return;
      
      try{
        const snap = await getDocs(collection(db, "travel_expenses"));
        const trips = new Set();
        tripTotals = {};
        
        snap.forEach(doc => {
          const data = doc.data();
          const t = data.trip;
          if(t && typeof t === 'string' && t.trim() !== ''){
            const key = t.trim();
            trips.add(key);
            if(!tripTotals[key]) tripTotals[key] = 0;
            tripTotals[key] += (data.amount || 0);
          }
        });

        const tripArr = Array.from(trips).sort();
        const selFilter = $("filter-trip");
        const dataList = $("trip-options");
        
        selFilter.innerHTML = '<option value="">Todos los viajes</option>' +
          tripArr.map(t => `<option value="${t}">${t} (${formatCurrency(tripTotals[t])})</option>`).join('');
        
        dataList.innerHTML = tripArr.map(t => `<option value="${t}">`).join('');
        
        console.log(`‚úÖ ${tripArr.length} viajes encontrados`);
      }catch(e){
        console.error("‚ùå Error fetching trips:", e);
      }
    }

    async function computeTotalForTrip(tripKey){
      if(!tripKey || tripKey === "") return 0;
      return tripTotals.hasOwnProperty(tripKey) && typeof tripTotals[tripKey] === 'number' ? tripTotals[tripKey] : 0;
    }

    /* ===== FORM ===== */
    function clearFormFields(){
      $("edit-id").value = '';
      $("expense-date").value = new Date().toISOString().split('T')[0];
      $("expense-category").value = '';
      $("expense-description").value = '';
      $("expense-amount").value = '';
      $("expense-payment-method").value = 'Efectivo';
      $("expense-trip").value = '';
      $("current-total-form").textContent = '$0';
      $("projected-total-form").textContent = '$0';
      $("submitLabel").textContent = 'Guardar';
    }

    async function loadExpenseIntoForm(id){
      if (!firebaseInitialized) return;
      
      try{
        const docRef = doc(db, "travel_expenses", id);
        const docSnap = await getDocs(query(collection(db,"travel_expenses"), where('__name__','==', id)));
        
        if(docSnap.empty){ 
          showToast("No se encontr√≥ el gasto", "danger"); 
          return; 
        }
        
        const data = docSnap.docs[0].data();
        $("edit-id").value = id;
        $("expense-date").value = (data.date && data.date.toDate) ? data.date.toDate().toISOString().slice(0,10) : new Date().toISOString().slice(0,10);
        $("expense-category").value = data.category || '';
        $("expense-description").value = data.description || '';
        $("expense-amount").value = data.amount || '';
        $("expense-payment-method").value = data.paymentMethod || 'Efectivo';
        $("expense-trip").value = data.trip || '';
        $("submitLabel").textContent = 'Actualizar Gasto';
        
        const key = $("expense-trip").value && $("expense-trip").value.trim()!=='' ? $("expense-trip").value.trim() : "";
        const tot = await computeTotalForTrip(key==="" ? "" : key);
        $("current-total-form").textContent = formatCurrency(tot);
        const amt = Number($("expense-amount").value)||0;
        $("projected-total-form").textContent = formatCurrency(tot + amt);
      }catch(e){
        console.error("‚ùå Load for edit error:", e);
        showToast("Error al cargar gasto para edici√≥n", "danger");
      }
    }
    
    function updateCategoryStats(catTotals){
      $("gasolina-amount").textContent= formatCurrency(catTotals.gasolina);
      $("hotel-amount").textContent   = formatCurrency(catTotals.hotel);
      $("comida-amount").textContent  = formatCurrency(catTotals.comida);
      $("bebida-amount").textContent  = formatCurrency(catTotals.bebida);
      
      const totalForChart = Object.values(catTotals).reduce((sum, val) => sum + val, 0);
      updateReportChart(totalForChart, catTotals);
    }

    function updateReportChart(total, catTotals){
      const ctx = $("expenses-chart");
      if(!ctx) return;
      if(window.expensesChart) window.expensesChart.destroy();
      window.expensesChart = new Chart(ctx.getContext('2d'), {
        type:'doughnut',
        data:{
          labels:['Gasolina','Hotel','Comida','Bebida'],
          datasets:[{
            data:[catTotals.gasolina, catTotals.hotel, catTotals.comida, catTotals.bebida],
            backgroundColor:['#60a5fa','#a78bfa','#34d399','#f59e0b'],
            borderWidth:2, borderColor:'rgba(255,255,255,0.9)'
          }]
        },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{
            legend:{ position:'bottom', labels:{ color:getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || '#0f172a' } },
            tooltip:{ callbacks:{ label: (c)=> `${c.label}: ${formatCurrency(c.parsed)}` } }
          }
        }
      });

      const pct = (v)=> total > 0 ? Math.round((v/total)*100) : 0;
      $("report-gasolina").textContent = `${pct(catTotals.gasolina)}%`;
      $("report-hotel").textContent    = `${pct(catTotals.hotel)}%`;
      $("report-comida").textContent   = `${pct(catTotals.comida)}%`;
      $("report-bebida").textContent   = `${pct(catTotals.bebida)}%`;
    }

    /* ===== Form validations y ARIA busy ===== */
    function setBusy(isBusy){
      const main = $("appMain");
      main.setAttribute('aria-busy', String(!!isBusy));
      document.body.setAttribute('aria-busy', String(!!isBusy));
    }

    function validateFormData(data){
      if(!data.date) return { ok:false, msg:'Selecciona una fecha' };
      if(!data.category) return { ok:false, msg:'Selecciona una categor√≠a' };
      if(!data.description || String(data.description).trim().length < 3) return { ok:false, msg:'La descripci√≥n debe tener al menos 3 caracteres' };
      if(!data.amount || Number(data.amount) <= 0) return { ok:false, msg:'El monto debe ser mayor a cero' };
      return { ok:true };
    }

    /* ===== Eventos UI ===== */
    document.addEventListener("DOMContentLoaded", async ()=>{
      console.log("üöÄ Aplicaci√≥n iniciada");
      
      const today = new Date();
      $("expense-date").value = today.toISOString().split('T')[0];
      $("filter-date").value  = today.toISOString().slice(0,7);

      // Verificar si Firebase est√° configurado
      if (!firebaseInitialized) {
        showToast("‚ö†Ô∏è IMPORTANTE: Configura Firebase en el c√≥digo (l√≠nea 1084)", "danger");
        console.error("‚ùå Firebase no configurado. Edita firebaseConfig con tus datos reales.");
      }

      await fetchTripsAndPopulate();
      await goToFirstPageAndRefresh();

      $("loadMoreBtn").addEventListener("click", async ()=>{ await loadMore(); });

      $("btnClearForm").addEventListener("click", ()=> clearFormFields());
      
      // Limpiar filtros
      $("btnClearFilters").addEventListener("click", ()=>{
        $("filter-search").value = '';
        $("filter-category").value = '';
        $("filter-date").value = today.toISOString().slice(0,7);
        $("filter-trip").value = '';
        goToFirstPageAndRefresh();
      });

      $("expense-form").addEventListener("submit", async (e)=>{
        e.preventDefault();
        const btn = e.currentTarget.querySelector('button[type="submit"]');
        btn.disabled = true;
        setBusy(true);

        try{
          const idEdit = $("edit-id").value || '';
          const data = {
            date: $("expense-date").value,
            category: $("expense-category").value,
            description: $("expense-description").value && $("expense-description").value.trim(),
            amount: Number($("expense-amount").value),
            paymentMethod: $("expense-payment-method").value,
            trip: ($("expense-trip").value || null)
          };

          const v = validateFormData(data);
          if(!v.ok){ showToast(v.msg, 'danger'); return; }

          let ok;
          if(idEdit){
            ok = await updateExpense(idEdit, data);
            if(ok) showToast('‚úÖ Gasto actualizado', 'primary');
            else showToast('‚ùå Error al actualizar', 'danger');
          } else {
            ok = await addExpense(data);
            if(ok) showToast('‚úÖ Gasto registrado', 'primary');
            else showToast('‚ùå Error al registrar', 'danger');
          }
          
          if(ok) {
            clearFormFields();
            await fetchTripsAndPopulate();
            await goToFirstPageAndRefresh();
            new bootstrap.Tab($('[data-bs-target="#expenses"]')).show();
          }

        } finally {
          btn.disabled = false;
          setBusy(false);
        }
      });
      
      const debouncedReload = debounce(()=> goToFirstPageAndRefresh(), 250);
      
      $("filter-search").addEventListener("input", debouncedReload);
      $("filter-category").addEventListener("change", debouncedReload);
      $("filter-date").addEventListener("change", debouncedReload);
      $("filter-trip").addEventListener("change", async function(){
        const total = await computeTotalForTrip(this.value || "");
        $("trip-total-badge").textContent = formatCurrency(total);
        debouncedReload();
      });

      const debouncedComputeTripForm = debounce(async (tripText)=>{
        const key = tripText && tripText.trim()!=='' ? tripText.trim() : "";
        const tot = await computeTotalForTrip(key==="" ? "" : key);
        $("current-total-form").textContent   = formatCurrency(tot);
        const amt = Number($("expense-amount").value)||0;
        $("projected-total-form").textContent = formatCurrency(tot + amt);
      }, 300);

      $("expense-trip").addEventListener("input", function(){ debouncedComputeTripForm(this.value); });
      $("expense-amount").addEventListener("input", ()=> {
        const amt = Number($("expense-amount").value)||0;
        const tripText = $("expense-trip").value;
        const key = tripText && tripText.trim()!=='' ? tripText.trim() : "";
        const current = (tripTotals.hasOwnProperty(key) && typeof tripTotals[key]==='number') ? tripTotals[key] : 0;
        $("projected-total-form").textContent = formatCurrency(current + amt);
      });
      
      document.querySelector(".fab").addEventListener("click", ()=>{
        clearFormFields();
        new bootstrap.Tab($('[data-bs-target="#add"]')).show();
      });
      
      document.querySelectorAll('#myTab button').forEach(btn=>{
        btn.addEventListener('shown.bs.tab', function(){
          const target = this.getAttribute('data-bs-target');
          document.querySelectorAll('.bottom-nav .nav-item').forEach(i=> i.classList.toggle('active', i.dataset.target === target));
          if(target==='#reports'){ setTimeout(()=>{ if(window.expensesChart) window.expensesChart.resize(); }, 120); }
        });
      });
      
      document.querySelectorAll('.bottom-nav .nav-item').forEach(i=>{
        i.addEventListener('click', ()=>{
          const t = i.dataset.target || '#expenses';
          new bootstrap.Tab(document.querySelector(`[data-bs-target="${t}"]`)).show();
        });
      });

    });

  </script>
</body>
</html>